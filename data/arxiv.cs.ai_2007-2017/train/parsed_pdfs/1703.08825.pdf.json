{
  "name" : "1703.08825.pdf",
  "metadata" : {
    "source" : "CRF",
    "title" : "Surrogate Model of Multi-Period Flexibility from a Home Energy Management System",
    "authors" : [ "Rui Pintoa", "Ricardo J. Bessaa", "Manuel A. Matosa" ],
    "emails" : [ "ricardo.j.bessa@inesctec.pt" ],
    "sections" : [ {
      "heading" : null,
      "text" : "Near-future electric distribution grids operation will have to rely on demand-side flexibility, both by implementation of demand response strategies and by taking advantage of the intelligent management of increasingly common small-scale energy storage. Home energy management systems (HEMS) will play a crucial role on the flexibility provision to both system operators and market players like aggregators. Modeling multi-period flexibility from residential consumers (HEMS flexibility), such as battery storage and electric water heater, while complying with internal constraints (comfort levels, data privacy) and uncertainty is a complex task. This paper describes a computational method that is capable of efficiently define and learn the feasible flexibility set from controllable resources connected to a HEMS. An Evolutionary Particle Swarm Optimization (EPSO) algorithm is adopted and reshaped to derive a set of feasible temporal trajectories for the residential net-load, considering storage, flexible appliances, and predefined costumer preferences, as well as load and photovoltaic (PV) forecast uncertainty. A support vector data description (SVDD) algorithm is used to build models capable of classifying feasible and unfeasible HEMS operating trajectories upon request from an optimization/control algorithm operated by a DSO or market player.\nKeywords: Energy management, flexibility, EPSO, multi-temporal, support vector data description, uncertainty"
    }, {
      "heading" : "1. Introduction",
      "text" : "Distributed Renewable Energy Sources (DRES) have been experiencing a fast growing in medium voltage (MV) and low voltage (LV) grids as the solar power technology becomes more and more affordable [1, 2]. Conventional power infrastructures were designed to accommodate unidirectional power flows coming from the large power plants to the more populating zones where most of the consumers exist. With the increasingly presence of DRES in LV and MV distribution grid, there is a paradigm change as the power flows start to reverse direction, particularly during sunny days or windy periods.\n∗Corresponding author Email address: ricardo.j.bessa@inesctec.pt (Ricardo J. Bessa)\nar X\niv :1\n70 3.\n08 82\n5v 3\n[ cs\n.N E\n] 2\n3 M\nay 2\nConsequently, technical difficulties regarding the operation of distribution grid start to arise for Distribution Systems Operators (DSO), with bus voltage limits being violated or even line congestion events.\nMicrogrids, composed with flexible loads, small-scale storage and their intelligent management by means of a Home Energy Management System (HEMS) combined with smart meters, can bring flexibility into the operation of distribution grids. DSOs can take advantage of the flexible nature of microgrids during grid stressful operation periods, use it for voltage control features at MV/LV substations [3], for power losses reduction, support unintentional microgrid operation [4], and to create operational conditions that maximize DRES hosting capacity that might bring financial benefits for prosumers and have a positive impact on the environmental causes related with the decarbonization of the electric power system.\nDomestic small-scale storage, heat-pumps, thermostatically controlled loads (TCL), and the electric vehicle will for sure be more common in residential type buildings in the near future, increasing the flexibility that can be provided within LV distribution grids, either by means of demand response programmes or flexibility aggregators participating in dedicated market sessions or even with single HEMS smart operation aiming at maximizing customers profits while supporting DSO in meeting specific operational criteria [5, 6]. The flexibility provision from HEMS monitoring and control capabilities is a theme of relevant significance as a result of the added value that can be brought to interested agents like DSOs and flexibility aggregators. Therefore, there is a need for developing flexibility models to capture the following characteristics: (a) multi-period flexibility from small-scale storage and TCL due to the inter-temporal nature of state of charge (SoC) and water temperature equations; (b) LV net-load patterns driven by weather conditions (e.g., PV generation) that introduce high uncertainty in the load forecasting task [7].\nMulti-period flexibility modeling is a rather recent topic, with few relevant research works dedicated to it. Zhao et al. studied a geometric approach that is capable of aggregating flexibility provided from TCL (represented as a “virtual” battery), and where the set of feasible power profiles of each TCL has been demonstrated to be a polytope [8]. The aggregation of several sets is performed by means of the Minkowski sum of the individual polytopes. The computational burden issue is tackled by the authors by adopting several approximations regarding the calculation of the Minkowski sums. Despite the merits of the work, domestic battery storage is not modeled and neither is the impact of net-load uncertainty, which are both relevant and challenging issues in this type of problems.\nThe “virtual” battery model was also explored by other authors, like Hughes et al. that proposed a first-order linear dynamical model for flexibility provision from residential HVAC systems in frequency regulation services, and generalizes the method to many other types of systems (or loads) [9]. The results showed that the developed technique still has challenges to overcome in modeling small-scale systems. Another example is Hao et al. that considered demand aggregation using battery models to model the set of feasible power profiles that a collection of TCLs can provide to track frequency regulation signals[10]. The TCL modeling assumes a simplified continuous power model where the error related to this simplification decreases as the size and homogeneity of the TCL aggregation increases.\nNosair et al. proposed a method to construct flexibility envelopes that describe the\nflexibility potential of power systems and its individual resources [11]. The proposed envelopes comprise all possible intra-hourly deviation and variation of the modeled DRES considering that for a certain sub-hourly time there is maximum output variability. Using the 95% percentile of the probability distribution of all the sub-hourly time steps the authors define an envelope which comprises the majority of realizations of flexibility requirements for that intervals. HEMS are not considered in this study, particularly the costumer’s preferences regarding the operation of their equipment, which makes the modeling problem more complex and simultaneously more realistic. Moreover, the multiperiod nature of flexibility is not modeled in the envelope.\nA similar concept is also proposed by Nuytten et al. [12]. The authors presented a methodology to estimate the maximum and minimum curves regarding the operation of the Combined Heat and Power (CHP) power plant combined with thermal storage. The difference between these two curves is indicated by the authors as being the theoretical maximum flexibility that the system can provide. This methodology can only be use to point out the mentioned maximum flexibility that the system is capable of providing for one specific time step in the time horizon considered, if one assumes that no flexibility has already been provided in a later period. No multi-temporal formulation has been adopted in this work, which means that a set of feasible power set-points regarding flexibility provision during more than one time step can not be provided by the proposed method. This flexibility representation was adopted in the European Project IndustRE as flexgraphs [13].\nUlbig and Anderson [14] describe a methodology to analyze the available flexibility for each time-step from an ensemble of diverse units in a confined grid zone. This flexibility is modeled as a Power Node, which allows for detailed modeling of specific constraints such as ramping constraints, power limits, as well as energy storage operation ranges. The authors propose a visual representation of the available flexibility during a specific time horizon. Nevertheless, this visual representation and modeling approach does not account for a multi-temporal formulation, meaning that the mentioned flexibility availability is only depicted for a single time step.\nA different representation for the flexibility is proposed in [15]. Bremer and Sonnenschein propose two sampling methods for defining the technically feasible flexibility set from distributed energy resources (DER). The authors, for instance, propose a Monte Carlo sampling method that starts with a feasible operating schedule and then, in each step, modifies it in at least one point in time with a random mutation factor. The methodology is used by the authors in a succeeding work where the obtained trajectories are used as a learning sample for a support vector data description (SVDD) machine learning algorithm [16]. Despite some similarities in the methodology with the work being presented in the present paper, this approach did not consider the modeling of costumers’ preferences neither accounted for the forecast uncertainty.\nIn summary, the main limitation of reviewed literature is that information about net-load forecast uncertainty is not included in the multi-period flexibility model, which, when included in DSO or aggregators optimization models, might lead solutions with low robustness to uncertainty. The present paper proposes an algorithm that is capable of modeling the multi-period flexibility from HEMS, including information about base net-load (i.e., inflexible load plus PV generation) forecast uncertainty represented by a set of short-term scenarios generated from probabilistic forecasts (marginal distribution functions) taking into account the temporal interdependency of forecast errors [17]).\nThe modeling strategy proposed in this work allows the interested parts to not have to model the equipment within the HEMS, which reduces the computational complexity and effort of problems such as multi-period OPF [18]. The uncertainty in the net-load profile is tackled in this study by means of a trajectory-based evaluation procedure using the convergence features of the EPSO (Evolutionary Particle Swarm Optimization [19]) algorithm that have been adopted (with other variants) in different types of power system related problems (see [20, 21, 22]). The proposed methodology has two main stages: first a sufficient number of HEMS flexibility trajectories is generated by the modified EPSO algorithm, and then, in the second stage those samples are used as input in a SVDD model that is capable of delimiting the feasible flexibility set of the respective HEMS. The potential interested parts, DSOs or demand/flexibility aggregators, only need to receive a reduced number of flexibility trajectories, called support vectors, which by means of a specific function to be embedded in their optimization tools allows them to identify unknown HEMS flexibility trajectories as being feasible or not.\nThe remaining of this paper is organized as follows: section 2 introduces the concept of multi-temporal flexibility adopted in this work; in section 3 the methodology adopted in this study is detailed, presenting the structure of the developed algorithm, and the approach to encode and distribute the generated information to interested parts; section 4 presents the results regarding the performance of the proposed tool; finally, in section 5 the main conclusions are presented."
    }, {
      "heading" : "2. HEMS Multi-period Flexibility",
      "text" : "Multi-period flexibility from HEMS can be defined as the ability to change the expected (baseline) net-load profile for a specific period of time (e.g., 24 hours period), by jointly considering information about flexible/inflexible load, PV generation, hot water demand, water temperature inside the electric water heater and the state of charge (SoC) of domestic battery storage.\nThe visual representation of the multi-period flexibility envelope is not as straightforward as one might assume. Actually, when dealing with problems that aim at defining the feasible flexibility set for more than three time steps ahead, the visual representation of such domain becomes impossible. There is a difference between the visual representation of the power limits in each time step that characterize the maximum flexibility band (like the flexibility envelope in [11, 12]) and the actual visual representation of the feasible flexibility set considering different temporal activations of flexible resources.\nFor the sake of clarity, let one assume that in the following example the flexibility provision can only be provided by a single domestic battery storage with 3.2 kWh of electrical energy capacity, maximum charge and discharge power of 1.5 kW, an initial SoC of 0.64 kWh (20%) and a minimum allowed SoC of 15% capacity, 0.48 kWh. In this example the battery efficiency is neglected. The upward and downward hourly limits of the flexibility band for this battery, considering the stated conditions, are depicted in Figure 1. This would represent the flexibility envelope or flexgraph from [11, 12]).\nThe outer limits of the flexibility domain represented in Figure 1 are defined by the previously mentioned upward and downward flexibility limits. The search domain defined in Figure 1 relates to what is commonly referred to as the flexibility power band. As the initial SoC is 0.64 kWh, the upward flexibility limit for the first considered operating time is equal to the maximum battery charging power, as with that the resulting SoC will be 2.14 kWh, considering hourly time steps and neglecting the battery’s efficiency. Analyzing the defined downward flexibility limits, namely the limit for the first time step considered, as the minimum allowed SoC is 15% of the storage capacity, 0.48 kWh, the maximum discharge power admissible is just 0.16 kW for a hourly time step. From the second operation time step considered onwards, both the upward and downward flexibility provision power limits correspond to the maximum charge and discharge rates, respectively. This occurs because there is always a possible flexibility trajectory that remains feasible while representing a choice of maximum charging or discharging power in any of the remaining time steps considered.\nWith that said, it is important to stress that, as previously stated, there is an important difference between the flexibility power band limits definition and the limits for the feasible flexibility provision envelope being tackled in this study. An example of that fact is the trajectory being depicted also in Figure 1 representing a possible flexibility offer expressed in kW [0.0, -0.5, 0.0]. Although the power set-points composing this trajectory\nare all within the limits of the defined flexibility power band, analyzing the SoC response to such trajectory (in kWh) [0.64, 0.14, 0.14] one can verify that the trajectory becomes infeasible from the second time step onwards as the minimum SoC constraint (SoC >= 0.48 kWh) is not being complied.\nThe representation for the flexibility space that is adopted in this paper is through a set of technically feasible net-load trajectories, which represent alternative paths to the expected (baseline) net-load profile (trajectory). In other words, these trajectories are samples taken from the multi-dimensional space forming the feasible flexibility set.\nConcluding, the concept of multi-temporal flexibility provision relates with the potential that a certain HEMS has of reshaping its expected net-load profile for a determined number of inter-temporal related periods, while complying with technical and physical internal constraints. The main focus of this study refers to the delimiting of the flexibility set that encompasses all the possible multi-temporal net-load profile variations that can be performed by the HEMS control functions. The next section describes the methodology that generates this set of temporal trajectories."
    }, {
      "heading" : "3. Methodology for Generation and Modeling the Feasible Flexibility Set",
      "text" : ""
    }, {
      "heading" : "3.1. Overview",
      "text" : "The methodology adopted in this study extends the previous work reported in [23] in which the feasible flexibility set is estimated using semi-randomly generated feasible trajectories and then feeding a SVDD algorithm with those trajectories. In that previous version of the algorithm, random sampling routines were being used to generate a sufficient number of feasible trajectories. In this new version, the construction of feasible trajectories no longer depends on a random sampling routine but instead an EPSO algorithm is being used to search for feasible trajectories. The use of the EPSO algorithm also enables the inclusion of information about base net-load uncertainty forecast (i.e., inflexible load plus PV generation) by means of solution evaluation for a set of different uncertainty scenarios, which greatly increases the complexity and computational effort. Accordingly, a feasible solution will be one that complies with all the constraints for a pre-defined probability threshold from all the possible HEMS base net-load scenarios considered, instead of using simply a point (or deterministic) forecast information like in the previous algorithm version.\nThe final set of feasible trajectories resulting from the EPSO search procedure are aggregated to create a learning dataset for the SVDD algorithm. The SVDD is an oneclass support vector machine algorithm that is commonly used in novelty detection, where a determined set of samples is provided to the function which in turn builds a model by detecting the soft boundary of that set [24]. Inspired by the methodology proposed in in [25] for the encoding of search spaces for virtual power plants application, the SVDD is used in this work for classifying new flexibility trajectories as belonging to that set or not. Or in other words, to check if a potential net-load profile is technically feasible or not.\nFigure 2 depicts the main stages of the proposed methodology in the form of a blockdiagram. There are three main boxes representing: the trajectory construction process; the learning of the feasible domain process; and the validation of the multi-period flexibility. The first stage concerns to the use of the EPSO algorithm to generate feasible\ntrajectories that comply with the defined customer’s preferences. These customer’s preferences are embedded into the proposed algorithm and are responsible of modeling the desire of minimizing the wasting of energy coming from PV generation, which means that the battery’s storage capacity must be used at its most to accommodate the energy surplus from PV generation. Another considered customer preference is the definition of the water temperature range inside the EWH tank, which must never surpass the defined minimum and maximum temperatures during the period of time in study.\nIn the second stage, the constructed feasible trajectories are used as input for the SVDD function which will result in the model construction and identification of the support vectors that define the boundaries of the feasibility domain. Finally, in the validation of multi-period flexibility stage, the interested agent (DSO or flexibility aggregator) can take advantage of the feasible domain knowledge coming from the information embedded in the provided support vector and define the optimal multi-period flexibility trajectory that is aligned with its operational needs while being viable to be provided by the HEMS/aggregation of HEMS."
    }, {
      "heading" : "3.2. EPSO Implementation for the Trajectory Searching Process",
      "text" : "The fundamental ideas behind the EPSO algorithm are the population based evolutionary programming concept where each combination of generated solution, X, and respective strategic parameters, weights - w, is called particle. There are five main steps in the general scheme of EPSO, namely:\n• Replication: where each particle is replicated;\n• Mutation: where each particle has its weights, w, mutated;\n• Reproduction: where an offspring is generated from each mutated particle according to the movement rule;\n• Evaluation: where each particle in the population has its fitness evaluated;\n• Selection: where, by means of stochastic tournament, the best particles survive to form the next generation.\nFor a given particle Xi, the new resulting particle, Xnewi , results from:\nXnewi = Xi + V newi (1)\nV newi = w∗i0Vi + w∗i1(bi −Xi) + w∗i2(b∗g −Xi) (2) This movement rule has the terms of inertia, memory and cooperation. The weights\nare subjected to mutation:\nw∗ik = wi1 + τN(0, 1) (3) where N(0, 1) is a random variable with Gaussian distribution with 0 mean and\nvariance 1. Additionally, the global best bg comes randomly disturbed:\nb∗g = bg + τ ′ N(0, 1) (4)\nIn (3) and (4) the τ and τ ′ are learning parameters. In this work, flexibility from domestic EWH and battery storage is included in the flexibility model. However, the methodology can be easily generalized to other flexible resources at the domestic and network level. The problem formulation has two decision variables and two state variables. The decision variables are the power flow in the domestic electric battery’s inverter, Pbat, and the operating point of the EWH, Pewh. The two state variables refer to the battery SoC and the water temperature inside the EWH tank.\nUsing the EPSO method, the developed algorithm incorporates in each particle information regarding the decision variables, Pbat and Pewh. Accordingly, each particle in this reshaped EPSO algorithm becomes a two-dimension object representing the two decision variables. The final fitness value of each particle, which represents the trajectory feasibility verification, is the result of the combined fitness evaluation of the two dimensions of each particle. During the fitness evaluation process the state variables are updated for the time steps considered. In the end, each feasible trajectory, traj, will result from the sum, for each time step, of the two dimensions of each of the selected particles, according to (5). The constraints used in this problem formulation are presented next.\ntrajh = Pbath + Pewhh (5)\nPbatmin <= Pbath <= Pbatmax (6)\nPewhh = {\n0, for off status Pewhnom, for on status\n(7)\nSoCini + H∑\nh=1 Pbath <= SoCmax (8)\nSoCini + H∑\nh=1 Pbath >= SoCmin (9)\nθmin <= θh <= θmax (10) The trajectories representing the flexibility that can be provided by the HEMS are limited to the battery’s charging and discharging powers (P batmax and P batmin) and the EWH nominal power (P ewhnom), (6) and (7) respectively. Regarding the maximum charging power, in this study a dynamic model is adopted where the maximum charging power depends on the SoC of the battery, which is a typical behavior for Li-ion batteries. This is explained by the two most common charging stages that occur when charging a lithium-ion battery, constant current and constant voltage [26]. During constant current charging stage the battery is basically connected to a current-limited power supply until reaching around 70-80% of its energy capacity. For superior SoC the battery enters the constant voltage stage where the charger acts as a voltage limited power supply and the charging current gradually decreases as the SoC approximates full capacity. The modeling used in this work is presented in Figure 3 where the maximum charging power starts to decrease for SoC superior to 80% and a minimum charging power of 20% nominal power is assumed. The inclusion of this non-linear behavior of battery storage also highlights the added value of the proposed method since it is not constrained by first-order linear models like in [9].\nIn each iteration of the algorithm, as part of the EPSO fitness evaluation process, the state variables must be assessed regarding the generated particles. Accordingly, the battery SoC and the water temperature of the EWH are computed based on the values of the previous time steps for the entire time horizon considered. As the developed EPSO algorithm considers a two-dimensional formulation, this state variable assessment procedure includes two independent functions. The trajectory feasibility relies on the fulfillment of (8), (9), and (10). For each time step where (8), (9), and (10) are not\nrespected, a penalty term is added in the penalty verification function of the particle being evaluated (11).\nPenaltyk = Pensocmax + Pensocmin + Pentempwater (11)\nEquation (12) represents the water temperature variation along the time horizon, which depends on the expected volume of hot water usage and the decision variable represented in the particle regarding the operating status of the EWH, P ewh. The physically-based load model adopted for the EWH modeling is aligned with the one used in [27].\nθh = θh-1 + ∆t C [−α(θh-1 − θhouse)− cpvh(θdes − θini) + Pewhh] (12)\nIn (12), ∆t is the time step [h], C is the thermal capacity [kWh/°C] set to 0.117, α is the thermal admittance [kWh/°C] set to −9.42−4, θhouse is the house indoor temperature set to 20 °C, cp is the water specific heat [kWh/(ltr.°C)], vh is the hot water consumption at time h, θdes is the desired temperature for water consumption set to 38 °C, and θinl is the inlet water temperature set to 17 °C.\nIn line with the information presented in Figure 2, the feasible trajectories generation process that takes place in the developed EPSO algorithm is not complete without the customer’s preferences validation. In this study, besides the assurance that the water temperature inside the EWH tank remains within the pre-established temperature range, one must assure that the main propose of the battery use prior to the HEMS flexibility offering remains being the accommodation of the PV generation surplus.\nThe validation of this customer requirement is accomplished by a scenario based approach that allows the EPSO resulting feasible flexibility set (trajectories) to incorporate the forecast uncertainty regarding the base net-load of the HEMS. Hence, a set of 100 short-term scenarios generated with a Gaussian copula (see [17] for more details) are used to represent forecast uncertainty of base load and PV generation in this methodology. This probabilistic information is included in the constraints of the optimization problem, resulting in a chance-constrained optimization problem that is solved with EPSO [28]. Let ς be the indicator function on the fulfillment of constraint (11), as represented by (13).\nς = {\n1, if Penaltyk = 0 0, if Penaltyk > 0\n(13)\nThe indicator function ς can be seen as a binary indicator that gets value 1 if the penalty verification function in (11) equals 0 (i.e., no constraints violation), and has the value 0 if the the penalty verification function results in a value grater that 0 representing constraints violation. In other words, if the constraints are violated in one interval of the net-load scenario, ς gets value 0 independently from the violation or not of the constraints in other intervals, which is guaranteed by (11). The EPSO fitness function comes from the sum of the indicator function for all the considered base net-load scenarios (14). Accordingly, and as defined in (15), for a trajectory to be considered robustly feasible it must comply with a scenario percentage threshold τ , e.g., the number of base net-load\nscenarios in which the trajectory remains feasible must be greater than a determined percentage of the total number of scenarios.\nFitk uncert = Nscen∑ s=1 ςs (14)\nFitk uncert > τ ∗Nscen (15)\nIn the second stage of the fitness evaluation process, the developed fitness function makes use of the information regarding the two decision variables and the state variable concerning the battery SoC. The main objective of this second stage is to update the SoC state variable taking into account the PV generation surplus, which must be accommodated by the battery, accounting for battery storage capacity and maximum charging power limitations. Thus, for each time step of the operation horizon considered, the SoC variable is updated by summing up the PV generation surplus, PV sur, which consequently increases the SoC, and subtracting the EWH possible power in those time steps. The combination between the PV generation surplus to be accommodated, the decision variable regarding the charging (or not) of the battery, and the decision variable representing the EWH operating status must respect the maximum charging power, by verifying (16).\nPbath + PV surh − Pewhh <= Pbatmax, ∀h (16) Additionally, (8) must give place to (17) to account for the PV generation surplus. The maximum and physically possible amount of PV surplus energy that the battery can absorb without being used for flexibility provision must still be assured when defining the feasible trajectories for flexibility provision.\nSoCini + H∑\nh=1 Pbath + PV hsur − Pewhh <= SoCmax (17)\nThere is a maximum amount of PV generation surplus that the battery is capable of accommodating, which is related to its storage capacity and it can vary along the time horizon depending on the precedent operation decisions. The maximum energy that the battery can accommodate results from the difference between the maximum and minimum SoC limits. To assess whether this specification is being respected or not along all the time steps considered, an auxiliary variable was created. Its initial value is set to the previously referred maximum energy that the battery can accommodate in each particle fitness evaluation procedure. If the accumulated PV energy surplus exceeds this maximum amount, the trajectory is not to be considered not feasible. The created auxiliary variable tracks down the supposed PV surplus energy accommodation capacity for each time step. In each time step where there is a PV generation surplus, its value is updated by subtracting its current value by the PV surplus to be accommodated in that time step, limited to the battery charging power. On the other hand, in each time step where there is not PV generation surplus, its value is updated by increasing the capacity to absorb by the discharging power limit of the battery.\nFigure 4 illustrates the evolution of the state variable regarding the battery SoC after this evaluation procedure takes place.\nFigure 4 represents, at the top, one of the 100 possible base net-load scenarios. As previously mentioned, to meet the costumer’s preferences, the battery SoC must be updated whenever the PV generation exceeds the load levels (represented by negative netload values). One consequence of this costumer preference modeling is that, in moments of PV surplus, the battery (HEMS) cannot present downward flexibility (only possible with battery discharging) since the battery must be used to accommodate the energy PV surplus through the charging mode. An example of this effect can be observed in Figure 4. The initial SoC variation depicted in the bottom chart shows that the SoC either stays unchanged or increases during the identified PV surplus moments. At the bottom, the resulting SoC variation along the considered time horizon can be compared to the original variation coming from the particle dimension related to the operation of the battery. As it can be seen from the figure analysis, the final SoC starts to differ from the initial SoC variation at the moment when the first net-load negative value occurs. The shape difference represents the PV generation surplus deducted the power consumed by the EWH in the flexibility provision.\nWith this updated SoC, the trajectory fitness evaluation can be carried out according to (11) for the different conditions that each base net-load scenario represents. Consequently, one can classify a certain trajectory as being or not robustly feasible by checking (14).\nIn each EPSO iteration, the ever encountered best global particle (i.e., the one with better fitness evaluation) needs to be updated. As referred, the fitness function used in this problem formulation only penalizes solutions that do not comply with the defined constraints. This means that there is no optimal solution in this searching process for which the EPSO algorithm is being used. Each particle that is feasible for all the considered scenarios will have the same fitness value. Therefore, the best global particle, bg, is selected based on the relative position of all the so far identified feasible trajectories. The aim here is that bg, which is used as reference in the movement rule, is chosen to increase the diversity of the feasible trajectories set. Accordingly, this selection procedure evaluates the relative position of all the elements in the set of feasible trajectories, looking for the one with the greatest distance relative to all the others.\nDistance = T∑\nt=1 (∣∣Pbat,t − Pmeanbat,t ∣∣)+ (∣∣Pewh,t − Pmeanewh,t ∣∣) (18) Thus, for each dimension and for all the time steps considered, the absolute distance between the particle position and the mean position of the feasible set is computed. The final distance comes from the accumulated distance along the time horizon considered, following (18)."
    }, {
      "heading" : "3.3. Black-box Model for the HEMS Flexibility",
      "text" : "The final EPSO algorithm output will be a large set of feasible temporal trajectories, which represent the feasible flexibility domain. The originated trajectories are to be used as a learning set of a SVDD function. The one-class support vector machine function available in the Scikit-Learn Python Library [24] was used. This learning dataset must have sufficient diversity among the built trajectories so that the resulting model is capable of efficiently delimit and learn the feasibility domain boundary.\nThe trained SVDD model identifies the necessary support vectors (domain boundary representative trajectories) that describe the high-dimension sphere representing the feasible domain and the respective coefficients. The support vectors together with the respective coefficients compose the data that is transmitted to the interested agents in order to quantify the HEMS flexibility potential. From the entire set of feasible trajectories that feed the SVDD function, some are selected by it regarding the significance that they have on delimiting the feasible domain. During this identification process, support vectors coefficients are also computed, which imposes more or less significance on certain support vectors. This means that some support vectors are more decisive on the delimiting of the feasible domain, which implies that the respective coefficients have a greater value. Applying (19) the SVDD model is capable of classifying new flexibility trajectories as feasible or not.\nR2(x) = 1− 2 ∑\ni βik(xi, x) + ∑ i,j βiβjk(xi, xj) (19)\nThis classification is based on the comparison of the radius of the high dimension sphere and the radius in the high dimension domain that the trajectory being classified represents. The formula that calculates the correspondent trajectory (and sphere’s) radius is expressed in equation (19), where R2 is the square of the radius being calculated,\nxi and xj are support vectors, βi and βj are the respective coefficients, k refers to the kernel type used by the SVDD function, and x is the trajectory being evaluated. More detailed information regarding this methodology can be consulted in [25] and [16]. The information in equation (19) can be integrated in any meta-heuristic optimization framework (like EPSO) to optimize the availability flexibility according to the end-user goals [29].\nTo be classified as feasible, a trajectory must represent a radius in the high dimension domain that is equal or inferior to the radius of the sphere representing the feasibility boundary. Figure 5 illustrates the SVDD classification procedure where the sphere representing the feasible flexibility space is defined by the identified support vectors. Trajectories whose projection falls within the flexibility space delimited by the sphere (in other others, trajectories that lead to radius smaller than the sphere’s radius) are considered feasible. On the other hand, trajectories leading to radius greater that the sphere’s radius are considered unfeasible, which in Figure 5 are represented by the triangle-shaped symbols outside the domain defined by the sphere.\nThe discrete nature of the EWH operation brings some challenges when defining the HEMS flexibility set, namely due to discontinuities that can be introduced by it. These discontinuities can be learnt by the SVDD algorithm, which might lead to misguiding\ntrajectory classification. In order to clearly illustrate this effect, let one consider a EWH and a electric battery as flexible assets inside a HEMS. If at a certain time step the battery, for reasons of its operating strategy, does not have flexibility provision capability, the only flexibility that the HEMS can provide comes from the EWH discrete operation. Thus, the SVDD function will learn that for the referred time step the HEMS can provide upward flexibility by the amount equal to the nominal power of the EWH. The resulting trajectory classification model will then consider as feasible flexibility provision values between 0 kW and the EWH nominal power, instead of a discrete representation. Nevertheless, these operation conditions are not frequent and this modeling glitch can be neglected when the battery has enough SoC margin to adjust its power output.\nAccording to the methodology introduced by this work, in order to define its flexibility potential the HEMS only needs to provide to the interested parts the computed support vectors and the respective coefficients, following (19), where xi and xj are the support vectors and βi and βj the respective coefficients. Accordingly, no information regarding customer’s demand patterns or installed equipment (like battery specifications) need to be revealed. This black-box model for the HEMS flexibility complies with recent concerns regarding costumer’s data privacy arising with the smart meter deployment [30, 31, 32]."
    }, {
      "heading" : "4. Results",
      "text" : "The performance assessment of the developed methodology was based on two main analyzes: the generation of feasible trajectories and the classification accuracy of SVDD models."
    }, {
      "heading" : "4.1. Generation of feasible trajectories",
      "text" : "As detailed in section 3, a trajectory will be classified as feasible when complying with the considered constraints for at least a pre-defined minimum percentage of base net-load scenarios. The constraints refer to battery’s SoC limits, EWH water temperature and the use of the battery during PV surplus periods. The EPSO algorithm is used to generate the set of feasible trajectories that will feed the SVDD function responsible to construct a model capable of identifying new trajectories as feasible or not.\nFor the base net-load forecast uncertainty of the HEMS, 100 short-term scenarios were used. In this study, for a certain trajectory to be considered feasible, it must comply with the problem constraints for at least 90 scenarios, which represents a probability of 90%. The time horizon corresponds to a 24 hours window with a 15 minutes resolution, leading to 96 time steps.\nThe EPSO algorithm was configured with a 30 particle population size, a maximum number of iterations of 5000, a feasible trajectories target of 1000, communication factors of 0.15 for both dimensions of the particles, maximum and minimum mutation rates of 0.50 and 0.05, respectively, and a learning parameter, τ , of 5. The mutation rate is dynamic throughout the process, beginning with the maximum value and decreasing until the minimum value as the number of iterations increase.\nFor helping in the convergence of the algorithm, an initial population is used, instead of using random values. This initial population fills the initial particles with decision values that respect the limits for the respective decision variables, Pbat and Pewh. Additionally, using one of the scenarios of HEMS net load profile, the PV energy surplus\nperiods were identified and used to zero the decision variable Pbat, so it approximates some of these initial particles to the costumer’s preference constraint of not discharging the battery during those periods and use it to accommodate the referred PV energy surplus.\nThe HEMS modeled in this study has as flexible assets a domestic battery and an EWH unit. The battery considered has 3.2 kWh capacity, maximum charging and discharging power of 1.5 kW and an efficiency of 92.5%. The initial SoC was set to 60% of the maximum capacity and the minimum SoC level was defined as 15% of the maximum capacity. Regarding the EWH, it has a nominal power of 0.5 kW, maximum and minimum water temperatures of 80°C and 45°C, respectively, and an initial water temperature of 60°C.\nFigure 6 depicts the 100 HEMS base net-load scenarios used in this study (top-left corner) and also a set of 100 feasible flexibility trajectories generated by the EPSO algorithm (bottom-left corner).\nThe net-load profile scenarios analysis (Figure 6 top-left corner) lets one identify the period of day of typical superior PV generation as the one that brings more uncertainty regarding the HEMS net-load. It is during this period that the HEMS net-load can present negative values, which relate to the costumer’s preference constraint of using the battery to minimize, as far as it is physical possible to the battery, the injection of PV energy in the grid. The impact of this constraint in the set of feasible trajectories constructed can be observed in the bottom charts depicted in Figure 6. The period between 07:30 and 13:00 has been zoomed in for improved clarity (right hand side charts\nof Figure 6). From 08:00 to 12:30 most of the net-load scenarios represent a power injection in the LV distribution grid, which imposes that the battery should not be used to provide downward flexibility. The right hand side bottom chart shows the flexibility trajectories for that period. As one can observe, most of the trajectories are providing 0 kW or 0.5 kW, the latter referring to the EWH nominal power. Values greater that 0.5 kW can occur if the respective trajectory has room to provide upward flexibility, while accommodating the PV energy surplus. Negative values are very uncommon and only can occur if when evaluating a certain particle for the use of the battery costumer preference the EWH power related decision variable counterbalances the negative net-load trajectories in some time steps. If that occurs, the battery can be used freely during such time steps to provide flexibility.\nRegarding the increase in the diversity of the solutions generated when comparing the current version of the algorithm with the preliminary one that used semi-random routines for the trajectory construction [23], an analysis was performed using the principle component analysis method, which applies an orthogonal transformation to convert a set of variables (with a set of observations) into a set of values of linearly uncorrelated variables (principal components). Basically, the aim is to verify which version of the algorithm produces a 1000 set of feasible trajectories that needs more components to explain a certain percentage of the variance of the respective produced set. Results show that the newest algorithm version presented in this work needs 5 components to explain 50% of the variance and 16 components to explain 80%, while, for the same conditions, the older version needs only 2 and 5, respectively. This proves that the set of feasible trajectories produced by the newest version of the algorithm is more diverse, which leads to a better representation of the feasible search space when using the computed trajectories as input to build the SVDD model.\nThe final set of 1000 feasible trajectories generated by the EPSO routine needed around 25 minutes to be constructed in a desktop computer with an Intel Core i7-2600 CPU running at 3.40 GHz and with 8.00 GB of installed RAM. The algorithm was developed on Python programming language."
    }, {
      "heading" : "4.2. Classification Accuracy of SVDD Models",
      "text" : "The other analysis carried out regarding the performance of the algorithm refers to the assessment of the SVDD classification accuracy of the multi-period trajectories. With that objective, two different sets of trajectories were used: one set composed by feasible trajectories and a second set of unfeasible trajectories. The purpose of using these two sets relates to the necessity of evaluating the classification process not only for the correct classification of feasible trajectories but also for correctly identifying unfeasible trajectories.\nRegarding the SVDD function, hyper-parameters had to be defined before the construction of the classification models. These hyper-parameters are the kernel type and coefficient (γ), which will influence the quality of the classification performance. For this problem, it was found that the most suitable type of kernel was the Sigmoid, being presented in Table 1 the performance results for that kernel type together with the results from models using the radial basis function and the polynomial kernels. Additionally, it was found that the fine tuning of the nu parameter can have a strong influence on the quality of the constructed SVDD model, which can be consulted in Table 1. For better\nmodel performance, the input trajectories were normalized for values between 0 and 1, regarding the minimum and maximum values from the EPSO feasible trajectories set. The time period used for this analysis ranged between 09:00 and 13:00 with 15 minutes time steps, resulting in a 16 time steps problem.\nThe nu parameter is a model configuration parameter and it refers to an upper bound on the fraction of training errors and a lower bound of the fraction of support vectors. Based on the results displayed in Table 1 one can verify that increasing the value of the nu parameter decreases the error on the classification of unfeasible trajectories, while increasing the error on classifying feasible ones. Therefore, there is a trade-off on defining the best parametrization for the SVDD models.\nIt was found that the configuration with γ = 0.05 and nu = 0.15 produces the most balanced classification model, resulting in errors for classifying feasible and not feasible trajectories of 14.98% and 15.45%, respectively. In the last iteration of the proposed approach, as depicted in Figure 2, the flexibility trajectories selected by the DSO or\nflexibility aggregator still have to be validated locally by the HEMS. In the case of a not feasible flexibility trajectory selection, the HEMS is responsible of indicating the most similar feasible trajectory that it can provide as flexibility to the interested agent."
    }, {
      "heading" : "5. Conclusions",
      "text" : "The operation of power system distribution grids are embracing considerable changes as the spread of DRES progressively becomes more significant. The smart grid and microgrid concepts are seen as crucial tools in this revolution taking place in LV and MV distribution grids as they increase DSO’s operation flexibility. Local and domesticscale microgeneration units (e.g., PV panels) and storage equipment along with flexible loads, such as EWH and HVAC systems, can be optimally managed within the HEMS concept. New ancillary services markets are expected to emerge justified by the necessity of gathering and supply this new flexibility that can be provided by these local assets.\nThis paper described a surrogate model for the behind-the-meter multi-period flexibility to be provided by HEMS. In a first stage, it generates a set of feasible net-load trajectories that are robust to net-load forecast uncertainty. Then, in a second phase it explores a support vector data description as a “black-box” model to communicate the flexibility set to different types of users, like DSO and flexibility aggregators.\nThe developed EPSO based algorithm used for searching feasible flexibility trajectories showed a high diversity in producing feasible solutions and, consequently, improved the efficiency of the created SVDD models that are responsible of learning the HEMS feasible flexibility set boundaries. More than that, the forecast uncertainty regarding the HEMS net-load profile is fully considered by means of fitness evaluation of the computed solutions for various base net-load short-term scenarios which was one of the major gaps identified in recent related literature. Consequently, the proposed methodology allows to control the robustness of the flexibility trajectories set.\nIt is crucial that the flexibility potential that is transmitted to the interested parts clearly incorporates the physical and operating constraints of the HEMS equipment and also the desired strategic modes of operation of such equipment defined by the HEMS owner. Results show that the constraints modeled in this problem formulation, namely, the power limits of the HEMS flexible assets, the SoC and temperature allowable ranges and, specially, the costumer’s preference constraint regarding the use of the battery during PV surplus periods, are being complied by the solutions computed. Additionally, the SVDD model classification performance was assessed for the classification of feasible and not feasible flexibility trajectories. For the model parameters configuration found to be most suitable the errors on the trajectories classification reached 15%. These errors were computed for a 16 time steps problem formulation. As the total number of time steps of the problem decreases the errors also tend to decrease. The SVDD parameters showed having significant impact on the model classification efficiency, imposing a tradeoff between the errors on evaluating feasible and not feasible trajectories.\nThe final output of this work is a tool that clearly adds value to and when used by DSOs and flexibility aggregators. On one hand, this tool can be embedded in current DSO planning and operating software endowing this agent of means of correctly model all the local flexibility potential within LV distribution grids in a time efficient fashion while complying with costumer privacy concerns. On the other hand, it can be similarly\nused by a flexibility aggregator to efficiently assess the true flexibility provision capacity that can be provided by the assets belonging to its portfolio.\nFuture work will focus on improving the efficiency of the classification procedure by the SVDD model and also on investigating new approaches to transmit to the interested agents the HEMS flexibility provision search space."
    }, {
      "heading" : "Acknowledgements",
      "text" : "The research leading to this work is being carried out as a part of the InteGrid project (Demonstration of INTElligent grid technologies for renewables INTEgration and INTEractive consumer participation enabling INTEroperable market solutions and INTErconnected stakeholders), which received funding from the European Union’s Horizon 2020 Framework Programme for Research and Innovation under grant agreement No. 731218.\nThe work was also supported in part by Fundação para a Ciência e a Tecnologia (FCT) under Grant SFRH/BD/117428/2016."
    } ],
    "references" : [ ],
    "referenceMentions" : [ ],
    "year" : 2017,
    "abstractText" : "Near-future electric distribution grids operation will have to rely on demand-side flex-<lb>ibility, both by implementation of demand response strategies and by taking advantage<lb>of the intelligent management of increasingly common small-scale energy storage. Home<lb>energy management systems (HEMS) will play a crucial role on the flexibility provision<lb>to both system operators and market players like aggregators. Modeling multi-period<lb>flexibility from residential consumers (HEMS flexibility), such as battery storage and<lb>electric water heater, while complying with internal constraints (comfort levels, data pri-<lb>vacy) and uncertainty is a complex task. This paper describes a computational method<lb>that is capable of efficiently define and learn the feasible flexibility set from controllable<lb>resources connected to a HEMS. An Evolutionary Particle Swarm Optimization (EPSO)<lb>algorithm is adopted and reshaped to derive a set of feasible temporal trajectories for<lb>the residential net-load, considering storage, flexible appliances, and predefined costumer<lb>preferences, as well as load and photovoltaic (PV) forecast uncertainty. A support vector<lb>data description (SVDD) algorithm is used to build models capable of classifying feasible<lb>and unfeasible HEMS operating trajectories upon request from an optimization/control<lb>algorithm operated by a DSO or market player.",
    "creator" : "LaTeX with hyperref package"
  }
}